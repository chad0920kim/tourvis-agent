<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>투어비스 에이전트 테스트</title>
</head>
<body>
  <h3>질문:</h3>
  <input id="q" style="width:300px" placeholder="예: 서울2 호텔 추천해줘" />
  <button onclick="send()">전송</button>

  <h3>응답:</h3>
  <pre id="resp" style="white-space: pre-wrap;"></pre>

  <script>
    async function send() {
      const chat_id = "user1";
      const message = document.getElementById("q").value;
      const resp = document.getElementById("resp");
      resp.textContent = "";

      const response = await fetch("https://tourvis-agent-mibqa.run.goorm.site/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id, message })
      });

      const reader = response.body.getReader();
      const decoder = new TextDecoder("utf-8");

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        const chunk = decoder.decode(value, { stream: true });

        const matches = [...chunk.matchAll(/"content":"(.*?)"/g)];
        for (const m of matches) {
          const text = m[1]
            .replace(/\\"/g, '"')
            .replace(/\\n/g, "\n")
            .replace(/\\\\/g, "\\");
          resp.textContent += text;
        }
      }
    }
  </script>
</body>
</html>
